
=== PROCESSING LOG ===
--- Sleep Scoring Pipeline - Iteration 3 ---

=== STEP 1: DATA LOADING ===
Loading all training data from S:/SignalGoupWork/training...
Found 10 recordings

Loading R1...
Loading training data from S:/SignalGoupWork/training\R1.edf and S:/SignalGoupWork/training\R1.xml...
Identified channels:
  EEG: ['EEG(sec)', 'EEG']
  EOG: ['EOG(L)', 'EOG(R)']
  EMG: ['EMG']
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EEG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EOG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EMG: 1 channels, 3750 samples/epoch, 125.0 Hz

Loaded 1084 epochs (9.03 hours)
Sleep stage distribution:
  Wake: 333 epochs (30.7%)
  N1: 47 epochs (4.3%)
  N2: 457 epochs (42.2%)
  N3: 145 epochs (13.4%)
  REM: 102 epochs (9.4%)

Loading R10...
Loading training data from S:/SignalGoupWork/training\R10.edf and S:/SignalGoupWork/training\R10.xml...
Identified channels:
  EEG: ['EEG(sec)', 'EEG']
  EOG: ['EOG(L)', 'EOG(R)']
  EMG: ['EMG']
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EEG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EOG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EMG: 1 channels, 3750 samples/epoch, 125.0 Hz

Loaded 1084 epochs (9.03 hours)
Sleep stage distribution:
  Wake: 251 epochs (23.2%)
  N1: 11 epochs (1.0%)
  N2: 491 epochs (45.3%)
  N3: 163 epochs (15.0%)
  REM: 168 epochs (15.5%)

Loading R2...
Loading training data from S:/SignalGoupWork/training\R2.edf and S:/SignalGoupWork/training\R2.xml...
Identified channels:
  EEG: ['EEG(sec)', 'EEG']
  EOG: ['EOG(L)', 'EOG(R)']
  EMG: ['EMG']
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EEG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EOG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EMG: 1 channels, 3750 samples/epoch, 125.0 Hz

Loaded 1079 epochs (8.99 hours)
Sleep stage distribution:
  Wake: 716 epochs (66.4%)
  N1: 3 epochs (0.3%)
  N2: 238 epochs (22.1%)
  N3: 61 epochs (5.7%)
  REM: 61 epochs (5.7%)

Loading R3...
Loading training data from S:/SignalGoupWork/training\R3.edf and S:/SignalGoupWork/training\R3.xml...
Identified channels:
  EEG: ['EEG(sec)', 'EEG']
  EOG: ['EOG(L)', 'EOG(R)']
  EMG: ['EMG']
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EEG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EOG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EMG: 1 channels, 3750 samples/epoch, 125.0 Hz

Loaded 1049 epochs (8.74 hours)
Sleep stage distribution:
  Wake: 332 epochs (31.6%)
  N1: 35 epochs (3.3%)
  N2: 289 epochs (27.6%)
  N3: 307 epochs (29.3%)
  REM: 86 epochs (8.2%)

Loading R4...
Loading training data from S:/SignalGoupWork/training\R4.edf and S:/SignalGoupWork/training\R4.xml...
Identified channels:
  EEG: ['EEG(sec)', 'EEG']
  EOG: ['EOG(L)', 'EOG(R)']
  EMG: ['EMG']
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EEG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EOG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EMG: 1 channels, 3750 samples/epoch, 125.0 Hz

Loaded 875 epochs (7.29 hours)
Sleep stage distribution:
  Wake: 273 epochs (31.2%)
  N1: 18 epochs (2.1%)
  N2: 177 epochs (20.2%)
  N3: 315 epochs (36.0%)
  REM: 92 epochs (10.5%)

Loading R5...
Loading training data from S:/SignalGoupWork/training\R5.edf and S:/SignalGoupWork/training\R5.xml...
Identified channels:
  EEG: ['EEG(sec)', 'EEG']
  EOG: ['EOG(L)', 'EOG(R)']
  EMG: ['EMG']
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EEG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EOG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EMG: 1 channels, 3750 samples/epoch, 125.0 Hz

Loaded 1084 epochs (9.03 hours)
Sleep stage distribution:
  Wake: 344 epochs (31.7%)
  N1: 42 epochs (3.9%)
  N2: 508 epochs (46.9%)
  N3: 99 epochs (9.1%)
  REM: 91 epochs (8.4%)

Loading R6...
Loading training data from S:/SignalGoupWork/training\R6.edf and S:/SignalGoupWork/training\R6.xml...
Identified channels:
  EEG: ['EEG(sec)', 'EEG']
  EOG: ['EOG(L)', 'EOG(R)']
  EMG: ['EMG']
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EEG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EOG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EMG: 1 channels, 3750 samples/epoch, 125.0 Hz

Loaded 1084 epochs (9.03 hours)
Sleep stage distribution:
  Wake: 310 epochs (28.6%)
  N1: 48 epochs (4.4%)
  N2: 529 epochs (48.8%)
  N3: 39 epochs (3.6%)
  REM: 158 epochs (14.6%)

Loading R7...
Loading training data from S:/SignalGoupWork/training\R7.edf and S:/SignalGoupWork/training\R7.xml...
Identified channels:
  EEG: ['EEG(sec)', 'EEG']
  EOG: ['EOG(L)', 'EOG(R)']
  EMG: ['EMG']
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EEG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EOG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EMG: 1 channels, 3750 samples/epoch, 125.0 Hz

Loaded 919 epochs (7.66 hours)
Sleep stage distribution:
  Wake: 254 epochs (27.6%)
  N1: 18 epochs (2.0%)
  N2: 459 epochs (49.9%)
  N3: 40 epochs (4.4%)
  REM: 148 epochs (16.1%)

Loading R8...
Loading training data from S:/SignalGoupWork/training\R8.edf and S:/SignalGoupWork/training\R8.xml...
Identified channels:
  EEG: ['EEG(sec)', 'EEG']
  EOG: ['EOG(L)', 'EOG(R)']
  EMG: ['EMG']
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EEG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EOG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EMG: 1 channels, 3750 samples/epoch, 125.0 Hz

Loaded 959 epochs (7.99 hours)
Sleep stage distribution:
  Wake: 288 epochs (30.0%)
  N1: 15 epochs (1.6%)
  N2: 362 epochs (37.7%)
  N3: 213 epochs (22.2%)
  REM: 81 epochs (8.4%)

Loading R9...
Loading training data from S:/SignalGoupWork/training\R9.edf and S:/SignalGoupWork/training\R9.xml...
Identified channels:
  EEG: ['EEG(sec)', 'EEG']
  EOG: ['EOG(L)', 'EOG(R)']
  EMG: ['EMG']
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EEG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EOG: 2 channels, 3750 samples/epoch, 125.0 Hz
NOTE: pick_channels() is a legacy function. New code should use inst.pick(...).
  EMG: 1 channels, 3750 samples/epoch, 125.0 Hz

Loaded 1086 epochs (9.05 hours)
Sleep stage distribution:
  Wake: 383 epochs (35.3%)
  N1: 38 epochs (3.5%)
  N2: 298 epochs (27.4%)
  N3: 236 epochs (21.7%)
  REM: 131 epochs (12.1%)

Combined EEG shape: (10303, 2, 3750)
Combined EOG shape: (10303, 2, 3750)
Combined EMG shape: (10303, 1, 3750)

Total loaded: 10303 epochs from 10 recordings
Record IDs: [np.str_('R1'), np.str_('R10'), np.str_('R2'), np.str_('R3'), np.str_('R4'), np.str_('R5'), np.str_('R6'), np.str_('R7'), np.str_('R8'), np.str_('R9')]
Sleep stage distribution:
  Wake: 3484 epochs (33.8%)
  N1: 275 epochs (2.7%)
  N2: 3808 epochs (37.0%)
  N3: 1618 epochs (15.7%)
  REM: 1118 epochs (10.9%)

Data loading summary:
  EEG: (10303, 2, 3750)
  EOG: (10303, 2, 3750)
  EMG: (10303, 1, 3750)
  Labels: (10303,)
  Unique recordings: 10
  Total epochs: 10303

=== STEP 2: PREPROCESSING ===
Preprocessing data for iteration 3...
Processing multi-channel data (EEG + EOG + EMG)
Multi-channel preprocessing applied to EEG + EOG + EMG
Iteration 3: Removing EOG artifacts from EEG using LinearRegression...
Iteration 3: Applying EMG-based adaptive low-pass filtering on EEG...
EMG 20–40 Hz power threshold (75th percentile): 2.0723e-11
Preprocessed EEG shape: (10303, 2, 3750)

=== STEP 3: FEATURE EXTRACTION ===
Extracting features for iteration 3...
[DEBUG] Multi-channel Iteration 3: (10303, 105) features extracted.
Extracted features shape: (10303, 105)

=== DEBUG: Raw features shape === (10303, 105)

=== STEP 4: FEATURE SELECTION ===

=== Feature Selection Pipeline (Iteration 3) ===
Initial feature count: 105

[Stage 1] Variance Thresholding (conservative)...
  Removed 89 low-variance features
  Remaining after stage1: 16

[Stage 2] Correlation Filtering (group-wise, keep highest-variance)...
  Removed 2 correlated features (|r| > 0.95)
  Remaining after stage2: 14

[Stage 3] Mutual Information Ranking...
  Feature count (14) ≤ top_k (40) → skipping MI selection.
Selected features shape: (10303, 14)

=== STEP 5: CLASSIFICATION ===

====================================================
 Training Classifier (Iteration 3)
====================================================
Features shape: (10303, 14)
Labels shape:   (10303,)


=== Iteration 3+: Random Forest ===

Random Forest trained.
Trained random_forest classifier

=== STEP 5: CLASSIFICATION ===

====================================================
 Training Classifier (Iteration 3)
====================================================
Features shape: (10303, 14)
Labels shape:   (10303,)


=== Iteration 3+: Random Forest ===

Random Forest trained.
Trained random_forest classifier
Data cached to cache/model_iter3.joblib
Saved trained model & scaler to cache: model_iter3.joblib

=== STEP 6: VISUALIZATION ===
DEBUG: scaler type: <class 'NoneType'>
Visualizing results...
DEBUG: scaler type: <class 'NoneType'>
DEBUG: scaler is None
DEBUG: no scaler provided, returning features unchanged

Classification report:
              precision    recall  f1-score   support

        Wake       0.95      0.81      0.88      3484
          N1       1.00      0.11      0.19       275
          N2       0.68      0.94      0.79      3808
          N3       0.86      0.78      0.82      1618
         REM       0.93      0.46      0.62      1118

    accuracy                           0.80     10303
   macro avg       0.89      0.62      0.66     10303
weighted avg       0.84      0.80      0.79     10303


=== STEP 7: PROCESSING LOG & REPORT GENERATION ===



# Sleep Scoring Report - Iteration 3

## Model
RandomForestClassifier

## Performance
Accuracy: 0.804
Kappa: 0.714
Macro F1-score: 0.643
Weighted F1-score: 0.793

## Time Domain Features
### Feature Count
- Total features: 14

Note: Feature details for Iteration 3 may include frequency-domain features.

## Sample Entropy Analysis
### Channel 1 Sample Entropy (Feature Index 13)
- **Status:** ✅ Sample Entropy is being computed
- **Non-zero values:** 10303/10303 (100.0%)
- **Overall Statistics:**
  - Minimum: 7.0000
  - Maximum: 240.0000
  - Mean: 62.7536
  - Median: 55.0000
  - Standard Deviation: 30.4790


## Notes
Report generated automatically from pipeline results.
